<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY drbdsetup_options SYSTEM "./drbdsetup-options.xml">
]>

<refentry id="re-drbdconf">
  &drbdsetup_options;

  <refentryinfo>
    <date>22 November 2012</date>

    <productname>DRBD</productname>

    <productnumber>9.0.0</productnumber>
  </refentryinfo>

  <refmeta>
    <refentrytitle>drbd.conf</refentrytitle>

    <manvolnum>5</manvolnum>

    <refmiscinfo class="manual">Configuration Files</refmiscinfo>
  </refmeta>

  <refnamediv>
    <refname>drbd.conf</refname>

    <refpurpose>Configuration file for DRBD devices<indexterm significance="normal">
        <primary>drbd.conf</primary>
      </indexterm></refpurpose>
  </refnamediv>

  <refsect1>
    <title>Introduction</title>

    <para>DRBD implements block devices which replicate their data to all nodes
    of a cluster.  The actual data and associated metadata are usually stored
    redundandly on "ordinary" block devices on each cluster node.</para>

    <para>Replicated block devices are called
    <option>/dev/drbd<replaceable>minor</replaceable></option> by default. They
    are grouped into resources, with one or more device per resource.
    Replication among the devices in a resource takes place in order. In DRBD,
    We refer to the devices inside a resource as volumes.</para>

    <para>In addition to resources, the volumes inside resources, and the
    cluster nodes on which a resource is replicated, drbd implements the
    concept of connections between nodes. At least for now, a connection is a
    point-to-point link between two cluster nodes.</para>

    <para>In DRBD 9.0, a resource can be replicated to two or more cluster
    nodes (or to a single cluster node only when constructing a new cluster or
    when recovering from a node failure). Connections must be defined between
    all pairs of cluster nodes, at least for the time being.</para>

    <para>DRBD consists of a kernel component, low-level user-space components
    which interact with the kernel and perform basic operations
    (<option>drbdsetup</option>, <option>drbdmeta</option>), and a high-level
    user-space component which understands and processes the DRBD configuration
    and translates it into basic operations of the low-level components
    (<option>drbdadm</option>).</para>

    <para>The default DRBD configuration consists of
    <option>/etc/drbd.conf</option> and of additional files included from
    there, usually <option>global_common.conf</option> and all
    <option><replaceable>*</replaceable>.res</option> files inside
    <option>/etc/drbd.d/</option>.  It has turned out to be useful to define
    each resource in a separate
    <option><replaceable>*</replaceable>.res</option> file.</para>

    <para>The configuration files are designed so that each cluster node can
    contain an identical copy of the entire cluster configuration. The host
    name of each node determines which parts of the configuration apply (uname
    -n).  It is highly recommended to keep the cluster configuration on all
    nodes in sync by manually updating it on all nodes, or by automating the
    process with <option>csync2</option> or a similar tool.</para>
  </refsect1>

  <refsect1>
    <title>example configuration file</title>
    <para>
        <title>A small example.res file</title>

        <programlisting format="linespecific">resource r0 {
	net {
		cram-hmac-alg sha1;
		shared-secret "FooFunFactory";
	}
	volume 0 {
		device    /dev/drbd1;
		disk      /dev/sda7;
		meta-disk internal;
	}
	on alice {
		node-id   0;
		address   10.1.1.31:7000;
	}
	on bob {
		node-id   1;
		address   10.1.1.32:7000;
	}
	connection {
		host alice port 7001;
		host bob port 7001;
		net { protocol C; }
	}
}</programlisting>
    In this example, there is a single DRBD resource (called r0) which uses protocol C
    for the connection between alice and bob, and protocol A for the other connections.
    It contains a single volume which runs on host
    <replaceable>alice</replaceable> uses <replaceable>/dev/drbd1</replaceable> as devices for its
    application, and <replaceable>/dev/sda7</replaceable> as low-level storage for the data. The
    IP addresses are used to specify the networking interfaces to be used.</para>

    <para>There may be multiple resource sections in a single drbd.conf file. For more examples,
    please have a look at the
    <ulink url="http://www.drbd.org/users-guide/"><citetitle>DRBD User's Guide</citetitle></ulink>.</para>

  </refsect1>

  <refsect1>
    <title>File Format</title>

    <para>DRBD configuration files consist of sections, which contain other
    sections and parameters depending on the sections' type. Each section
    consists of one or more keywords, sometimes a section name, an opening
    brace (<quote>{</quote>), the section's contents, and a closing brace
    (<quote>}</quote>). Parameters inside a section consist of a keyword,
    followed by one or more keyword or value, and a semicolon
    (<quote>;</quote>).</para>

    <para>Some parameter values have a default scale which applies when a plain
    number is specified (for example Kilo, or 1024 times the numeric value).
    Such default scales can be overridden by using a suffix (for example, 10M
    for 10 Mega).  The common suffixes K = 2^10 = 1024, M = 1024 K, and G =
    1024 M are supported.</para>

    <para>Comments start with a hash sign (<quote>#</quote>) and extend to the
    end of the line. In addition, any section can be prefixed with the keyword
    <option>skip</option>, which causes the section and any sub-sections to be
    ignored.</para>

    <para>Additional files can be included with the <option>include
    <replaceable>file-pattern</replaceable></option> statement (see
    <citerefentry><refentrytitle>glob</refentrytitle><manvolnum>7</manvolnum></citerefentry>
    for the expressions supported in <replaceable>file-pattern</replaceable>).
    Include statements are only allowed outside of sections.</para>

    <para>The following sections are defined (indentation indicates in
    which context):
      <programlisting>
common
   [disk]
   [handlers]
   [net]
   [options]
   [startup]
global
resource
   connection
      net
   [disk]
   floating
   handlers
   [net]
   on
      [disk]
      volume
         disk
   options
   stacked-on-top-of
   startup
      </programlisting>
    Sections in brackets affect other parts of the configuration: inside the
    <option>common</option> section, they apply to all resources. A
    <option>disk </option>section inside a <option>resource</option> or
    <option>on</option> section applies to all volumes of that resource, and a
    <option>net</option> section inside a <option>resource</option> section
    applies to all connections of that resource. This allows to avoid repeating
    identical options for each resource, connection, or volume. Options can
    be overridden in a more specific <option>resource</option>,
    <option>connection</option>, <option>on</option>, or
    <option>volume</option> section.</para>

    <refsect2>
      <title>Sections</title>

      <variablelist>
        <varlistentry>
          <term><option>common</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>common</secondary>
	      </indexterm> This section can contain each a
	      <option>disk</option>, <option>handlers</option>,
	      <option>net</option>, <option>options</option>, and
	      <option>startup</option> section. All resources inherit the
	      parameters in these sections as their default values.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
	  <term><option>connection <replaceable><optional>name</optional></replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>connection</secondary>
	      </indexterm> Define a connection between two hosts. This section
	      must contain two <option>host</option> parameters.
	      The <replaceable>name</replaceable> is
	      used to refer to the connection in the system log and in other
	      messages. If no name is specified, the peer's host name
	      is used instead.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>disk</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>disk</secondary>
	      </indexterm> Define parameters for a volume. All parameters in
	      this section are optional.
	    </para>
          </listitem>
        </varlistentry>

        <varlistentry>
	  <term><option>floating <replaceable><optional>address-family</optional></replaceable> <replaceable>addr:port</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>floating</secondary>
	      </indexterm> Like the <option>on</option> section, except that
	      instead of the host name, the IP addresses of a host are used to
	      determine if it matches a <option>floating</option>
	      section.</para>

	    <para>The
	    <option>node-id</option> parameter must be defined in this
	    section.  The <option>address</option> parameter is not required.
	    The <option>device</option>, <option>disk</option>, and
	    <option>meta-disk</option> parameters must be defined in or
	    inherited by this section.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>global</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>global</secondary>
	      </indexterm> Define some global parameters.  All parameters in
	      this section are optional.  Only one <option>global</option>
	      section is allowed in the configuration.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>handlers</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>handlers</secondary>
	      </indexterm> Define handlers to be invoked when certain events
	      occur. The kernel passes the resource name in the first
	      command-line argument and sets the following environment
	      variables depending on the event's context:
	      <itemizedlist>
		<listitem>
			<para>For events related to a particular device:
			the device's minor number in
			<option>DRBD_MINOR</option>, the device's volume number
			in <option>DRBD_VOLUME</option>.
		  </para>
		</listitem>
		<listitem>
		  <para>For events related to a particular device on a
		  particular peer: the connection endpoints in
		  <option>DRBD_MY_ADDRESS</option>,
		  <option>DRBD_MY_AF</option>,
		  <option>DRBD_PEER_ADDRESS</option>,
		  <option>DRBD_PEER_AF</option>, the device's local minor
		  number in <option>DRBD_MINOR</option>, the device's volume
		  number in <option>DRBD_VOLUME</option>.
		  </para>
		</listitem>
		<listitem>
		  <para>For events related to a particular connection: the
		  connection endpoints in <option>DRBD_MY_ADDRESS</option>,
		  <option>DRBD_MY_AF</option>,
		  <option>DRBD_PEER_ADDRESS</option>,
		  <option>DRBD_PEER_AF</option>, for each device defined for
		  that connection: the device's minor number in
		  <option>DRBD_MINOR_<replaceable>volume-number</replaceable></option>.
		  </para>
		</listitem>
		<listitem>
		  <para>For events that identify a device, if a lower-level
		  device is attached, the lower-level device's device name is
		  passed in <option>DRBD_BACKING_DEV</option> (or
		  <option>DRBD_BACKING_DEV_<replaceable>volume-number</replaceable></option>).
		  </para>
	      </listitem>
	      </itemizedlist>
	    </para>
	    <para>All parameters in this section are optional. Only a single
	    handler can be defined for each event; if no handler is defined,
	    nothing will happen.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>net</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>net</secondary>
	      </indexterm> Define parameters for a connection. All parameters
	      in this section are optional.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
	  <term><option>on</option> <option><replaceable>host-name</replaceable></option> <replaceable><optional>...</optional></replaceable></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>on</secondary>
	      </indexterm> Define the properties of a resource on a particular
	      host or set of hosts. Specifying more than one host names can
	      make sense in a setup with IP address failover, for
	      example. The <replaceable>host-name</replaceable> argument must
	      match the Linux host name (uname -n).</para>

	    <para>Usually contains or inherits at least one
	    <option>volume</option> section. The <option>node-id</option> and
	    <option>address</option> parameters must be defined in this
	    section. The <option>device</option>, <option>disk</option>, and
	    <option>meta-disk</option> parameters must be defined in or
	    inherited by this section.</para>

	    <para>A normal configuration file contains two or more
	    <option>on</option> sections for each resource. Also see the
	    <option>floating</option> section.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>options</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>options</secondary>
	      </indexterm> Define parameters for a resource. All parameters
	      in this section are optional.</para>
	  </listitem>
	</varlistentry>

        <varlistentry>
	  <term><option>resource</option> <option><replaceable>name</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>resource</secondary>
	      </indexterm> Define a resource. Usually contains at least two
	      <option>on</option> sections and at least one
	      <option>connection</option> section.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>stacked-on-top-of <replaceable>resource</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>stacked-on-top-of</secondary>
	    </indexterm> Used instead of an <option>on</option> section for
	    configuring a stacked resource with three to four nodes.</para>
	  <para>Starting with DRBD 9.0, stacking is deprecated.  It
	  is advised to use resources with more than two hosts (and more than
	  one connection) instead.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>startup</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>startup</secondary>
	      </indexterm> The parameters in this section determine the
	      behavior of a resource at startup time.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
	  <term><option>volume</option> <option><replaceable>volume-number</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>volume</secondary>
	      </indexterm> Define a volume within a resource. The volume
	      numbers in the various <option>volume</option> sections of a
	      resource define which devices on which hosts form a replicated
	      device.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>connection</option> Parameters</title>

      <variablelist>
        <varlistentry>
          <term><option>host <replaceable>name</replaceable> port <replaceable>port-no</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>host</secondary>
              </indexterm>
	    A host statement must refer to an host section (<option>on</option> keyword). Optionally
	    the port keyword may override the port given in the host section for this connection. Two
	    host statements are expected in an <option>connection</option> section.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>disk</option> Parameters</title>

      <variablelist>
	<pick_drbdsetup_option name="al-extents"/>
	<pick_drbdsetup_option name="al-updates"/>
	<pick_drbdsetup_option name="c-delay-target"/>
	<pick_drbdsetup_option name="c-min-rate"/>
	<pick_drbdsetup_option name="disk-barrier"/>
	<!-- <pick_drbdsetup_option name="disk-size"/> -->
	<pick_drbdsetup_option name="disk-timeout"/>
	<pick_drbdsetup_option name="fencing"/>
	<pick_drbdsetup_option name="md-flushes"/>
	<pick_drbdsetup_option name="on-io-error"/>
	<pick_drbdsetup_option name="read-balancing"/>
	<pick_drbdsetup_option name="resync-after"/>
	<pick_drbdsetup_option name="resync-rate"/>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>global</option> Parameters</title>

      <variablelist>
	<pick_drbdsetup_option name="dialog-refresh"/>
	<pick_drbdsetup_option name="disable-ip-verification"/>
	<pick_drbdsetup_option name="usage-count"/>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>handlers</option> Parameters</title>

      <variablelist>
	<varlistentry>
	  <term><option>after-resync-target <replaceable>cmd</replaceable></option></term>

	  <listitem>
	    <para><indexterm significance="normal">
		<primary>drbd.conf</primary>

		<secondary>after-resync-target</secondary>
	      </indexterm> DRBD calls this handler just after a resync operation finished on the
	    node whose disk just became consistent after being inconsistent for the duration of
	    the resync. It might be used to remove a snapshot of the backing device that was
	    created by the <option>before-resync-target</option> handler.</para>
	  </listitem>
	</varlistentry>

        <varlistentry>
          <term><option>before-resync-target <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>before-resync-target</secondary>
              </indexterm> DRBD calls this handler just before a resync begins on the node that
            becomes resync target. It might be used to take a snapshot of the backing block
            device.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>fence-peer <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>fence-peer</secondary>
              </indexterm> The handler is part of the <option>fencing</option> mechanism. This
            handler is called in case the node needs to fence the peer's disk. It should use other
            communication paths than DRBD's network link.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>initial-split-brain <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>initial-split-brain</secondary>
              </indexterm> DRBD has connected and detected a split brain situation. This handler
            can alert someone in all cases of split brain, not just those that go
            unresolved.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>local-io-error <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>local-io-error</secondary>
              </indexterm> DRBD got an IO error from the local IO subsystem.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>pri-lost <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>pri-lost</secondary>
              </indexterm> The node is currently primary, but DRBD's algorithm thinks that it
            should become sync target. As a consequence it should give up its primary role.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>pri-lost-after-sb <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>pri-lost-after-sb</secondary>
              </indexterm> The node is currently primary, but lost the after-split-brain auto
            recovery procedure. As as consequence, it should be abandoned.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>pri-on-incon-degr <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>pri-on-incon-degr</secondary>
              </indexterm> This handler is called if the node is primary, degraded and if the
            local copy of the data is inconsistent.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>split-brain <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>split-brain</secondary>
              </indexterm> DRBD detected a split brain situation but remains unresolved. Manual
            recovery is necessary. This handler should alert someone on duty.</para>
          </listitem>
        </varlistentry>

      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>net</option> Parameters</title>

      <variablelist>
	<pick_drbdsetup_option name="after-sb-0pri"/>
	<pick_drbdsetup_option name="after-sb-1pri"/>
	<pick_drbdsetup_option name="after-sb-2pri"/>
	<pick_drbdsetup_option name="allow-two-primaries"/>
	<pick_drbdsetup_option name="always-asbp"/>
	<pick_drbdsetup_option name="connect-int"/>
	<pick_drbdsetup_option name="cram-hmac-alg"/>
	<pick_drbdsetup_option name="csums-alg"/>
	<pick_drbdsetup_option name="data-integrity-alg"/>
	<pick_drbdsetup_option name="ko-count"/>
	<pick_drbdsetup_option name="max-buffers"/>
	<pick_drbdsetup_option name="max-epoch-size"/>
	<pick_drbdsetup_option name="on-congestion"/>
	<pick_drbdsetup_option name="ping-int"/>
	<pick_drbdsetup_option name="ping-timeout"/>
	<pick_drbdsetup_option name="protocol"/>
	<pick_drbdsetup_option name="rcvbuf-size"/>
	<pick_drbdsetup_option name="rr-conflict"/>
	<pick_drbdsetup_option name="shared-secret"/>
	<pick_drbdsetup_option name="sndbuf-size"/>
	<pick_drbdsetup_option name="tcp-cork"/>
	<pick_drbdsetup_option name="timeout"/>
	<pick_drbdsetup_option name="unplug-watermark"/>
	<pick_drbdsetup_option name="use-rle"/>
	<pick_drbdsetup_option name="verify-alg"/>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>on</option> Parameters</title>

      <variablelist>
        <varlistentry>
	  <term><option>address <replaceable><optional>address-family</optional></replaceable> <replaceable>addr:port</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>address</secondary>
              </indexterm> A resource needs one <replaceable>IP</replaceable> address per device,
            which is used to wait for incoming connections from the partner device respectively to
            reach the partner device. <replaceable>address-family</replaceable> must be one of
            <option>ipv4</option>, <option>ipv6</option>, <option>ssocks</option> or
            <option>sdp</option> (for compatibility reasons <option>sci</option> is an alias for
            <option>ssocks</option>). It may be omited for IPv4 addresses. The actual IPv6 address
            that follows the <option>ipv6</option> keyword must be placed inside brackets:
            <literal moreinfo="none">ipv6 [fd01:2345:6789:abcd::1]:7800</literal>.</para>

            <para>Each DRBD resource needs a TCP <replaceable>port</replaceable> which is used to
            connect to the node's partner device. Two different DRBD resources may not use the
            same <replaceable>addr:port</replaceable> combination on the same node.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>node-id <replaceable>value</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>node-id</secondary>
              </indexterm>
	      <replaceable>value</replaceable> must be a integer number in the range
	      from 0 to 33. Each node needs an unique node-id in the cluster.</para>

            <para>Only change the node-id if all nodes of the cluster are down, and
	    change the node-id in the meta-data at the same time.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>options</option> Parameters (In <option>resource</option> Sections)</title>

      <variablelist>
	<pick_drbdsetup_option name="auto-promote"/>
	<pick_drbdsetup_option name="cpu-mask"/>
	<pick_drbdsetup_option name="on-no-data-accessible"/>
	<pick_drbdsetup_option name="peer-ack-window"/>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>startup</option> Parameters</title>

      <variablelist>
        <varlistentry>
          <term><option>become-primary-on <replaceable>node-name</replaceable></option></term>

          <listitem>
            <para>Sets on which node the device should be promoted to primary role by the init
            script. The <replaceable>node-name</replaceable> might either be a host name or the
            keyword <option>both</option>. When this option is not set the devices stay in
            secondary role on both nodes. Usually one delegates the role assignment to a cluster
            manager (e.g. heartbeat).</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>degr-wfc-timeout <replaceable>time</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>degr-wfc-timeout</secondary>
              </indexterm> Wait for connection timeout, if this node was a degraded cluster. In
            case a degraded cluster (= cluster with only one node left) is rebooted, this timeout
            value is used instead of wfc-timeout, because the peer is less likely to show up in
            time, if it had been dead before. Value 0 means unlimited.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>outdated-wfc-timeout <replaceable>time</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>outdated-wfc-timeout</secondary>
              </indexterm> Wait for connection timeout, if the peer was outdated. In case a
            degraded cluster (= cluster with only one node left) with an outdated peer disk is
            rebooted, this timeout value is used instead of wfc-timeout, because the peer is not
            allowed to become primary in the meantime. Value 0 means unlimited.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>stacked-timeouts</option></term>

          <listitem>
            <para>Usually <option>wfc-timeout</option> and <option>degr-wfc-timeout</option> are
            ignored for stacked devices, instead twice the amount of <option>connect-int</option>
            is used for the connection timeouts. With the <option>stacked-timeouts</option>
            keyword you disable this, and force DRBD to mind the <option>wfc-timeout</option> and
            <option>degr-wfc-timeout</option> statements. Only do that if the peer of the stacked
            resource is usually not available or will usually not become primary. By using this
            option incorrectly, you run the risk of causing unexpected split brain.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>wait-after-sb</option></term>

          <listitem>
            <para>By setting this option you can make the init script to continue to wait even if
            the device pair had a split brain situation and therefore refuses to connect.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>wfc-timeout <replaceable>time</replaceable></option></term>

          <listitem>
            <para>Wait for connection timeout. <indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>wfc-timeout</secondary>
              </indexterm> The init script <citerefentry>
                <refentrytitle>drbd</refentrytitle>

                <manvolnum>8</manvolnum>
              </citerefentry> blocks the boot process until the DRBD resources are connected. When
            the cluster manager starts later, it does not see a resource with internal
            split-brain. In case you want to limit the wait time, do it here. Default is 0, which
            means unlimited. The unit is seconds.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>volume</option> Parameters</title>

      <variablelist>
        <varlistentry>
          <term><option>device <replaceable>name</replaceable> minor
          <replaceable>nr</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>device</secondary>
              </indexterm> The name of the block device node of the resource being described. You
            must use this device with your application (file system) and you must not use the low
            level block device which is specified with the <option>disk</option> parameter.</para>

            <para>One can ether omit the <replaceable>name</replaceable> or <option>minor</option>
            and the <replaceable>minor number</replaceable>. If you omit the
            <replaceable>name</replaceable> a default of /dev/drbd<replaceable>minor</replaceable>
            will be used.</para>

            <para>Udev will create additional symlinks in /dev/drbd/by-res and
            /dev/drbd/by-disk.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>disk <replaceable>name</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>disk</secondary>
              </indexterm> DRBD uses this block device to actually store and retrieve the data.
            Never access such a device while DRBD is running on top of it. This also holds true
            for <citerefentry>
                <refentrytitle>dumpe2fs</refentrytitle>

                <manvolnum>8</manvolnum>
              </citerefentry> and similar commands.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>meta-disk internal</option></term>

          <term><option>meta-disk <replaceable>device</replaceable></option></term>

	  <term><option>meta-disk <replaceable>device</replaceable> [<replaceable>index</replaceable>]</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>meta-disk</secondary>
              </indexterm> Internal means that the last part of the backing device is used to
	      store the meta-data.  The size of the meta-data is computed based on the size of the
	      device.</para>

            <para>When a <replaceable>device</replaceable> is specified, either with or without an
	    <replaceable>index</replaceable>, DRBD stores the meta-data on this device.  Without
	    <replaceable>index</replaceable>, the size of the meta-data is determined by the size
	    of the data device. This is usually used with LVM, which allows to have many variable
	    sized block devices. The meta-data size is 36kB + Backing-Storage-size / 32k, rounded up
	    to the next 4kb boundary.  (Rule of the thumb: 32kByte per 1GByte of storage, rounded up
	    to the next MB.)</para>

	    <para>When an <replaceable>index</replaceable> is specified, each index number refers to
	    a fixed slot of meta-data of 128 MB, which allows a maximum data size of 4 GB. This way,
	    multiple DBRD devices can share the same meta-data device.  For example, if /dev/sde6[0]
	    and /dev/sde6[1] are used, /dev/sde6 must be at least 256 MB big. Because of the hard size
	    limit, use of meta-disk indexes is discouraged.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </refsect2>
  </refsect1>

  <refsect1 id="data-integrity">
    <title>Notes on data integrity</title>

    <para>There are two independent methods in DRBD to ensure the integrity of the mirrored data.
    The online-verify mechanism and the <option>data-integrity-alg</option> of the
    <option>network</option> section.</para>

    <para>Both mechanisms might deliver false positives if the user of DRBD modifies the data
    which gets written to disk while the transfer goes on. This may happen for swap, or for
    certain append while global sync, or truncate/rewrite workloads, and not necessarily poses a
    problem for the integrity of the data. Usually when the initiator of the data transfer does
    this, it already knows that that data block will not be part of an on disk data structure, or
    will be resubmitted with correct data soon enough.</para>

    <para>The <option>data-integrity-alg</option> causes the receiving side to log an error about
    "Digest integrity check FAILED: Ns +x\n", where N is the sector offset, and x is the size of
    the request in bytes. It will then disconnect, and reconnect, thus causing a quick resync. If
    the sending side at the same time detected a modification, it warns about "Digest mismatch,
    buffer modified by upper layers during write: Ns +x\n", which shows that this was a false
    positive. The sending side may detect these buffer modifications immediately after the
    unmodified data has been copied to the tcp buffers, in which case the receiving side won't
    notice it.</para>

    <para>The most recent (2007) example of systematic corruption was an issue with the TCP
    offloading engine and the driver of a certain type of GBit NIC. The actual corruption happened
    on the DMA transfer from core memory to the card. Since the TCP checksum gets calculated on
    the card, this type of corruption stays undetected as long as you do not use either the online
    <option>verify</option> or the <option>data-integrity-alg</option>.</para>

    <para>We suggest to use the <option>data-integrity-alg</option> only during a pre-production
    phase due to its CPU costs. Further we suggest to do online <option>verify</option> runs
    regularly e.g. once a month during a low load period.</para>
  </refsect1>

  <refsect1>
    <title>Version</title>

    <simpara>This document was revised for version 8.4.0 of the DRBD distribution.</simpara>
  </refsect1>

  <refsect1>
    <title>Author</title>

    <simpara>Written by Philipp Reisner <email>philipp.reisner@linbit.com</email> and Lars
    Ellenberg <email>lars.ellenberg@linbit.com</email>.</simpara>
  </refsect1>

  <refsect1>
    <title>Reporting Bugs</title>

    <simpara>Report bugs to <email>drbd-user@lists.linbit.com</email>.</simpara>
  </refsect1>

  <refsect1>
    <title>Copyright</title>

    <simpara>Copyright 2001-2008 LINBIT Information Technologies, Philipp Reisner, Lars Ellenberg.
    This is free software; see the source for copying conditions. There is NO warranty; not even
    for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</simpara>
  </refsect1>

  <refsect1>
    <title>See Also</title>

    <para><citerefentry>
        <refentrytitle>drbd</refentrytitle>

        <manvolnum>8</manvolnum>
      </citerefentry>, <citerefentry>
        <refentrytitle>drbddisk</refentrytitle>

        <manvolnum>8</manvolnum>
      </citerefentry>, <citerefentry>
        <refentrytitle>drbdsetup</refentrytitle>

        <manvolnum>8</manvolnum>
      </citerefentry>, <citerefentry>
        <refentrytitle>drbdadm</refentrytitle>

        <manvolnum>8</manvolnum>
      </citerefentry>,
      <ulink url="http://www.drbd.org/users-guide/"><citetitle>DRBD User's Guide</citetitle></ulink>,
       <ulink url="http://www.drbd.org/"><citetitle>DRBD web site</citetitle></ulink></para>

  </refsect1>
</refentry>
