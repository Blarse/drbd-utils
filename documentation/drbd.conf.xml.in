<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY drbdsetup_options SYSTEM "./drbdsetup-options.xml">
]>

<refentry id="re-drbdconf">
  &drbdsetup_options;

  <refentryinfo>
    <date>22 November 2012</date>

    <productname>DRBD</productname>

    <productnumber>9.0.0</productnumber>
  </refentryinfo>

  <refmeta>
    <refentrytitle>drbd.conf</refentrytitle>

    <manvolnum>5</manvolnum>

    <refmiscinfo class="manual">Configuration Files</refmiscinfo>
  </refmeta>

  <refnamediv>
    <refname>drbd.conf</refname>

    <refpurpose>Configuration file for DRBD devices<indexterm significance="normal">
        <primary>drbd.conf</primary>
      </indexterm></refpurpose>
  </refnamediv>

  <refsect1>
    <title>Introduction</title>

    <para>DRBD implements block devices which replicate their data to all nodes
    of a cluster.  The actual data and associated metadata are usually stored
    redundandly on "ordinary" block devices on each cluster node.</para>

    <para>Replicated block devices are called
    <option>/dev/drbd<replaceable>minor</replaceable></option> by default. They
    are grouped into resources, with one or more device per resource.
    Replication among the devices in a resource takes place in order. In DRBD,
    We refer to the devices inside a resource as volumes.</para>

    <para>In addition to resources, the volumes inside resources, and the
    cluster nodes on which a resource is replicated, drbd implements the
    concept of connections between nodes. At least for now, a connection is a
    point-to-point link between two cluster nodes.</para>

    <para>In DRBD 9.0, a resource can be replicated to two or more cluster
    nodes (or to a single cluster node only when constructing a new cluster or
    when recovering from a node failure). Connections must be defined between
    all pairs of cluster nodes, at least for the time being.</para>

    <para>DRBD consists of a kernel component, low-level user-space components
    which interact with the kernel and perform basic operations
    (<option>drbdsetup</option>, <option>drbdmeta</option>), and a high-level
    user-space component which understands and processes the DRBD configuration
    and translates it into basic operations of the low-level components
    (<option>drbdadm</option>).</para>

    <para>The default DRBD configuration consists of
    <option>/etc/drbd.conf</option> and of additional files included from
    there, usually <option>global_common.conf</option> and all
    <option><replaceable>*</replaceable>.res</option> files inside
    <option>/etc/drbd.d/</option>.  It has turned out to be useful to define
    each resource in a separate
    <option><replaceable>*</replaceable>.res</option> file.</para>

    <para>The configuration files are designed so that each cluster node can
    contain an identical copy of the entire cluster configuration. The host
    name of each node determines which parts of the configuration apply (uname
    -n).  It is highly recommended to keep the cluster configuration on all
    nodes in sync by manually updating it on all nodes, or by automating the
    process with <option>csync2</option> or a similar tool.</para>
  </refsect1>

  <refsect1>
    <title>example configuration file</title>
    <para>
        <title>A small example.res file</title>

        <programlisting format="linespecific">resource r0 {
	net {
		cram-hmac-alg sha1;
		shared-secret "FooFunFactory";
	}
	volume 0 {
		device    /dev/drbd1;
		disk      /dev/sda7;
		meta-disk internal;
	}
	on alice {
		node-id   0;
		address   10.1.1.31:7000;
	}
	on bob {
		node-id   1;
		address   10.1.1.32:7000;
	}
	connection {
		host alice port 7001;
		host bob port 7001;
		net { protocol C; }
	}
}</programlisting>
    In this example, there is a single DRBD resource (called r0) which uses protocol C
    for the connection between alice and bob, and protocol A for the other connections.
    It contains a single volume which runs on host
    <replaceable>alice</replaceable> uses <replaceable>/dev/drbd1</replaceable> as devices for its
    application, and <replaceable>/dev/sda7</replaceable> as low-level storage for the data. The
    IP addresses are used to specify the networking interfaces to be used.</para>

    <para>There may be multiple resource sections in a single drbd.conf file. For more examples,
    please have a look at the
    <ulink url="http://www.drbd.org/users-guide/"><citetitle>DRBD User's Guide</citetitle></ulink>.</para>

  </refsect1>

  <refsect1>
    <title>File Format</title>

    <para>DRBD configuration files consist of sections, which contain other
    sections and parameters depending on the sections' type. Each section
    consists of one or more keywords, sometimes a section name, an opening
    brace (<quote>{</quote>), the section's contents, and a closing brace
    (<quote>}</quote>). Parameters inside a section consist of a keyword,
    followed by one or more keyword or value, and a semicolon
    (<quote>;</quote>).</para>

    <para>Some parameter values have a default scale which applies when a plain
    number is specified (for example Kilo, or 1024 times the numeric value).
    Such default scales can be overridden by using a suffix (for example, 10M
    for 10 Mega).  The common suffixes K = 2^10 = 1024, M = 1024 K, and G =
    1024 M are supported.</para>

    <para>Comments start with a hash sign (<quote>#</quote>) and extend to the
    end of the line. In addition, any section can be prefixed with the keyword
    <option>skip</option>, which causes the section and any sub-sections to be
    ignored.</para>

    <para>Additional files can be included with the <option>include
    <replaceable>file-pattern</replaceable></option> statement (see
    <citerefentry><refentrytitle>glob</refentrytitle><manvolnum>7</manvolnum></citerefentry>
    for the expressions supported in <replaceable>file-pattern</replaceable>).
    Include statements are only allowed outside of sections.</para>

    <para>The following sections are defined (indentation indicates in
    which context):
      <programlisting>
common
   [disk]
   [handlers]
   [net]
   [options]
   [startup]
global
resource
   connection
      net
   [disk]
   floating
   handlers
   [net]
   on
      [disk]
      volume
         disk
   options
   stacked-on-top-of
   startup
      </programlisting>
    Sections in brackets affect other parts of the configuration: inside the
    <option>common</option> section, they apply to all resources. A
    <option>disk </option>section inside a <option>resource</option> or
    <option>on</option> section applies to all volumes of that resource, and a
    <option>net</option> section inside a <option>resource</option> section
    applies to all connections of that resource. This allows to avoid repeating
    identical options for each resource, connection, or volume. Options can
    be overridden in a more specific <option>resource</option>,
    <option>connection</option>, <option>on</option>, or
    <option>volume</option> section.</para>

    <refsect2>
      <title>Sections</title>

      <variablelist>
        <varlistentry>
          <term><option>common</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>common</secondary>
	      </indexterm> This section can contain each a
	      <option>disk</option>, <option>handlers</option>,
	      <option>net</option>, <option>options</option>, and
	      <option>startup</option> section. All resources inherit the
	      parameters in these sections as their default values.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
	  <term><option>connection <replaceable><optional>name</optional></replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>connection</secondary>
	      </indexterm> Define a connection between two hosts. This section
	      must contain two <option>host</option> parameters.
	      The <replaceable>name</replaceable> is
	      used to refer to the connection in the system log and in other
	      messages. If no name is specified, the peer's host name
	      is used instead.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>disk</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>disk</secondary>
	      </indexterm> Define parameters for a volume. All parameters in
	      this section are optional.
	    </para>
          </listitem>
        </varlistentry>

        <varlistentry>
	  <term><option>floating <replaceable><optional>address-family</optional></replaceable> <replaceable>addr:port</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>floating</secondary>
	      </indexterm> Like the <option>on</option> section, except that
	      instead of the host name, the IP addresses of a host are used to
	      determine if it matches a <option>floating</option>
	      section.</para>

	    <para>The
	    <option>node-id</option> parameter must be defined in this
	    section.  The <option>address</option> parameter is not required.
	    The <option>device</option>, <option>disk</option>, and
	    <option>meta-disk</option> parameters must be defined in or
	    inherited by this section.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>global</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>global</secondary>
	      </indexterm> Define some global parameters.  All parameters in
	      this section are optional.  Only one <option>global</option>
	      section is allowed in the configuration.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>handlers</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>handlers</secondary>
	      </indexterm> Define handlers to be invoked when certain events
	      occur. The kernel passes the resource name in the first
	      command-line argument and sets the following environment
	      variables depending on the event's context:
	      <itemizedlist>
		<listitem>
			<para>For events related to a particular device:
			the device's minor number in
			<option>DRBD_MINOR</option>, the device's volume number
			in <option>DRBD_VOLUME</option>.
		  </para>
		</listitem>
		<listitem>
		  <para>For events related to a particular device on a
		  particular peer: the connection endpoints in
		  <option>DRBD_MY_ADDRESS</option>,
		  <option>DRBD_MY_AF</option>,
		  <option>DRBD_PEER_ADDRESS</option>,
		  <option>DRBD_PEER_AF</option>, the device's local minor
		  number in <option>DRBD_MINOR</option>, the device's volume
		  number in <option>DRBD_VOLUME</option>.
		  </para>
		</listitem>
		<listitem>
		  <para>For events related to a particular connection: the
		  connection endpoints in <option>DRBD_MY_ADDRESS</option>,
		  <option>DRBD_MY_AF</option>,
		  <option>DRBD_PEER_ADDRESS</option>,
		  <option>DRBD_PEER_AF</option>, for each device defined for
		  that connection: the device's minor number in
		  <option>DRBD_MINOR_<replaceable>volume-number</replaceable></option>.
		  </para>
		</listitem>
		<listitem>
		  <para>For events that identify a device, if a lower-level
		  device is attached, the lower-level device's device name is
		  passed in <option>DRBD_BACKING_DEV</option> (or
		  <option>DRBD_BACKING_DEV_<replaceable>volume-number</replaceable></option>).
		  </para>
	      </listitem>
	      </itemizedlist>
	    </para>
	    <para>All parameters in this section are optional. Only a single
	    handler can be defined for each event; if no handler is defined,
	    nothing will happen.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>net</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>net</secondary>
	      </indexterm> Define parameters for a connection. All parameters
	      in this section are optional.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
	  <term><option>on</option> <option><replaceable>host-name</replaceable></option> <replaceable><optional>...</optional></replaceable></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>on</secondary>
	      </indexterm> Define the properties of a resource on a particular
	      host or set of hosts. Specifying more than one host names can
	      make sense in a setup with IP address failover, for
	      example. The <replaceable>host-name</replaceable> argument must
	      match the Linux host name (uname -n).</para>

	    <para>Usually contains or inherits at least one
	    <option>volume</option> section. The <option>node-id</option> and
	    <option>address</option> parameters must be defined in this
	    section. The <option>device</option>, <option>disk</option>, and
	    <option>meta-disk</option> parameters must be defined in or
	    inherited by this section.</para>

	    <para>A normal configuration file contains two or more
	    <option>on</option> sections for each resource. Also see the
	    <option>floating</option> section.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>options</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>options</secondary>
	      </indexterm> Define parameters for a resource. All parameters
	      in this section are optional.</para>
	  </listitem>
	</varlistentry>

        <varlistentry>
	  <term><option>resource</option> <option><replaceable>name</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>resource</secondary>
	      </indexterm> Define a resource. Usually contains at least two
	      <option>on</option> sections and at least one
	      <option>connection</option> section.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>stacked-on-top-of <replaceable>resource</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>stacked-on-top-of</secondary>
	    </indexterm> Used instead of an <option>on</option> section for
	    configuring a stacked resource with three to four nodes.</para>
	  <para>Starting with DRBD 9.0, stacking is deprecated.  It
	  is advised to use resources with more than two hosts (and more than
	  one connection) instead.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>startup</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>startup</secondary>
	      </indexterm> The parameters in this section determine the
	      behavior of a resource at startup time.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
	  <term><option>volume</option> <option><replaceable>volume-number</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>volume</secondary>
	      </indexterm> Define a volume within a resource. The volume
	      numbers in the various <option>volume</option> sections of a
	      resource define which devices on which hosts form a replicated
	      device.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>connection</option> Parameters</title>

      <variablelist>
        <varlistentry>
	  <term><option>host <replaceable>name</replaceable></option>
	    <optional><option>port
		<replaceable>port-number</replaceable></option></optional></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>host</secondary>
              </indexterm>
	    Define an endpoint for a connection. Each <option>host</option>
	    statement refers to an <option>on</option> section in a resource.
	    If a port number is defined, this endpoint will use the specified
	    port instead of the port defined in the <option>on</option>
	    section.  Each <option>connection</option> section must contain
	    exactly two <option>host</option> parameters.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>disk</option> Parameters</title>

      <variablelist>
	<pick_drbdsetup_option name="al-extents"/>
	<pick_drbdsetup_option name="al-updates"/>
	<pick_drbdsetup_option name="c-delay-target"/>
	<pick_drbdsetup_option name="c-min-rate"/>
	<pick_drbdsetup_option name="disk-barrier"/>
	<!-- <pick_drbdsetup_option name="disk-size"/> -->
	<pick_drbdsetup_option name="disk-timeout"/>
	<pick_drbdsetup_option name="fencing"/>
	<pick_drbdsetup_option name="md-flushes"/>
	<pick_drbdsetup_option name="on-io-error"/>
	<pick_drbdsetup_option name="read-balancing"/>
	<pick_drbdsetup_option name="resync-after"/>
	<pick_drbdsetup_option name="resync-rate"/>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>global</option> Parameters</title>

      <variablelist>
	<pick_drbdsetup_option name="dialog-refresh"/>
	<pick_drbdsetup_option name="disable-ip-verification"/>
	<pick_drbdsetup_option name="usage-count"/>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>handlers</option> Parameters</title>

      <variablelist>
	<varlistentry>
	  <term><option>after-resync-target <replaceable>cmd</replaceable></option></term>

	  <listitem>
	    <para><indexterm significance="normal">
		<primary>drbd.conf</primary>

		<secondary>after-resync-target</secondary>
	      </indexterm> Called on a resync target when a node's state
	      changes from Inconsistent to Consistent when a resync finishes.
	      This handler can be used for removing the snapshot created in the
	      <option>before-resync-target</option> handler.</para>
	  </listitem>
	</varlistentry>

        <varlistentry>
          <term><option>before-resync-target <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>before-resync-target</secondary>
	      </indexterm> Called on a resync target before a resync begins.
	      This handler can be used for creating a snapshot of the
	      lower-level device for the duration of the resync: if the resync
	      source becomes unavailable during a resync, reverting to the
	      snapshot can restore a consistent state.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>fence-peer <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>fence-peer</secondary>
	      </indexterm> Called when a node should fence a resource on a
	      particular peer. The handler should not use the same
	      communication path that DRBD uses for talking to the peer.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>initial-split-brain <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>initial-split-brain</secondary>
	      </indexterm> Called when DRBD connects to a peer and detects that
	      the peer is in a split-brain state with the local node.  This
	      handler is also called for split-brain scenarios which will be
	      resolved automatically.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>local-io-error <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>local-io-error</secondary>
	      </indexterm> Called when an I/O error occurs on a lower-level device.
	    </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>pri-lost <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>pri-lost</secondary>
	      </indexterm>
	      The local node is currently primary, but DRBD believes that it
	      should become a sync target. The node should give up its primary
	      role.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>pri-lost-after-sb <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>pri-lost-after-sb</secondary>
	      </indexterm> The local node is currently primary, but it has lost
	      the after-split-brain auto recovery procedure. The node should be
	      abandoned. <!-- FIXME: What is "abandon a node" supposed to mean? --></para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>pri-on-incon-degr <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>pri-on-incon-degr</secondary>
	      </indexterm> This handler is called if the local node is primary,
	      degraded, and if the lower-level device is inconsistent.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>split-brain <replaceable>cmd</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>split-brain</secondary>
	      </indexterm> DRBD has detected a split-brain situation which
	      could not be resolved automatically.  Manual recovery is
	      necessary. This handler can be used to call for administrator
	      attention.</para>
          </listitem>
        </varlistentry>

      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>net</option> Parameters</title>

      <variablelist>
	<pick_drbdsetup_option name="after-sb-0pri"/>
	<pick_drbdsetup_option name="after-sb-1pri"/>
	<pick_drbdsetup_option name="after-sb-2pri"/>
	<pick_drbdsetup_option name="allow-two-primaries"/>
	<pick_drbdsetup_option name="always-asbp"/>
	<pick_drbdsetup_option name="connect-int"/>
	<pick_drbdsetup_option name="cram-hmac-alg"/>
	<pick_drbdsetup_option name="csums-alg"/>
	<pick_drbdsetup_option name="data-integrity-alg"/>
	<pick_drbdsetup_option name="ko-count"/>
	<pick_drbdsetup_option name="max-buffers"/>
	<pick_drbdsetup_option name="max-epoch-size"/>
	<pick_drbdsetup_option name="on-congestion"/>
	<pick_drbdsetup_option name="ping-int"/>
	<pick_drbdsetup_option name="ping-timeout"/>
	<pick_drbdsetup_option name="protocol"/>
	<pick_drbdsetup_option name="rcvbuf-size"/>
	<pick_drbdsetup_option name="rr-conflict"/>
	<pick_drbdsetup_option name="shared-secret"/>
	<pick_drbdsetup_option name="sndbuf-size"/>
	<pick_drbdsetup_option name="tcp-cork"/>
	<pick_drbdsetup_option name="timeout"/>
	<pick_drbdsetup_option name="unplug-watermark"/>
	<pick_drbdsetup_option name="use-rle"/>
	<pick_drbdsetup_option name="verify-alg"/>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>on</option> Parameters</title>

      <variablelist>
        <varlistentry>
	  <term><option>address
	      <replaceable><optional>address-family</optional></replaceable>
	      <replaceable>address:port</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>address</secondary>
	      </indexterm> Define the address family, address, and port of a
	      connection endpoint.</para>

	    <para>The address families <option>ipv4</option>,
	      <option>ipv6</option>, <option>ssocks</option>,
	      <option>sdp</option>, and <option>sci</option> are supported
	      (<option>sci</option> being an alias for <option>ssocks</option>).
	      If no address family is specified, <option>ipv4</option> is
	      assumed.  For all address families except <option>ipv6</option>,
	      the address is specified in IPV4 address syntax (1.2.3.4
	      notation).  For <option>ipv6</option>, the address is enclosed in
	      brackets and uses IPv6 address syntax (for example, <literal
		moreinfo="none">[fd01:2345:6789:abcd::1]</literal>).  The port
	      is always specified as a decimal number between 1 and 65535.</para>

	    <para>On each host, the port numbers must be unique for each
	      address; ports cannot be shared.</para>
	  <!-- FIXME: The port should be made optional to avoid duplicate
		      information here and in the connection sections. -->
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>node-id <replaceable>value</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>node-id</secondary>
              </indexterm>
	      Define the unique node identifier for a node in the cluster.
	      Node identifiers are used to identify individual nodes in the
	      network protocol, and to assign bitmap slots to nodes in the
	      metadata.</para>

	    <para>Node identifiers can only be reasssigned in a cluster when
	      the cluster is down.  It is essential that the node identifiers
	      in the configuration and in the device metadata are changed
	      consistently on all hosts.  To change the metadata, dump the
	      current state with "drbdmeta dump-md", adjust the bitmap slot
	      assignment, and update the metadata with "drbdmeta
	      restore-md".</para>

	    <para>The <option>node-id</option> parameter exists since DRBD
	      9.0.0.  Its value ranges from 0 to 16; there is no
	      default.</para>
	  </listitem>
	</varlistentry>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>options</option> Parameters (Resource Options)</title>

      <variablelist>
	<pick_drbdsetup_option name="auto-promote"/>
	<pick_drbdsetup_option name="cpu-mask"/>
	<pick_drbdsetup_option name="on-no-data-accessible"/>
	<pick_drbdsetup_option name="peer-ack-window"/>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>startup</option> Parameters</title>

      <para>The parameters in this section define the behavior of DRBD at
	system startup time, in the DRBD init script.  They have no effect once
	the system is up and running.</para>

      <variablelist>
        <varlistentry>
          <term><option>degr-wfc-timeout <replaceable>timeout</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>degr-wfc-timeout</secondary>
	      </indexterm> Define how long to wait until all peers are
	      connected in case the cluster consisted of a single node only
	      when the system went down.  This parameter is usually set to a
	      timeout smaller than <option>wfc-timeout</option>.  The
	      assumption here is that peers which were unreachable before a
	      reboot are less likele to be be reachable after the reboot, so
	      waiting is less likely to help.</para>

	    <para>The timeout is specified in seconds. The default value is 0,
	      or an infinite timeout.  Also see the
	      <option>wfc-timeout</option> parameter.</para>
	      <!-- FIXME: How does wfc-timeout vs. degr-wfc-timeout work with
		   more than two nodes in the cluster?  If a cluster is only
		   "degraded" when only one node remains and only one out of
		   three nodes fails, we will still wait for that one node for
		   wfc-timeout, which might be forever. -->
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>outdated-wfc-timeout <replaceable>timeout</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>outdated-wfc-timeout</secondary>
	      </indexterm> Define how long to wait until all peers are
	      connected if all peers were outdated when the system went down.
	      This parameter is usually set to a timeout smaller than
	      <option>wfc-timeout</option>.  The assumption here is that an
	      outdated peer cannot have become primary in the meantime, so we
	      don't need to wait for it as long as for a node which was alive
	      before.</para>

	    <para>The timeout is specified in seconds. The default value is 0,
	      or an infinite timeout.  Also see the
	      <option>wfc-timeout</option> parameter.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>stacked-timeouts</option></term>

          <listitem>
	    <para>On stacked devices, the <option>wfc-timeout</option> and
	      <option>degr-wfc-timeout</option> parameters in the configuration
	      are usually ignored, and both timeouts are set to twice the
	      <option>connect-int</option> timeout.  The
	      <option>stacked-timeouts</option> parameter tells DRBD to use the
	      <option>wfc-timeout</option> and
	      <option>degr-wfc-timeout</option> parameters as defined in the
	      configuration, even on stacked devices.  Only use this parameter
	      if the peer of the stacked resource is usually not available, or
	      will not become primary.  Incorrect use of this parameter can
	      lead to unexpected split-brain scenarios.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>wait-after-sb</option></term>

          <listitem>
	    <para>This parameter causes DRBD to continue waiting in the init
	      script even when a split-brain situation has been detected, and
	      the nodes therefore refuse to connect to each other.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>wfc-timeout <replaceable>timeout</replaceable></option></term>

          <listitem>
	    <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>wfc-timeout</secondary>
	      </indexterm> Define how long to wait until all peers are
	      connected.  Later when the cluster manager starts, it will not
	      see a resource with internal split-brain.  The timeout is
	      specified in seconds. The default value is 0, or an infinite
	      timeout.  Also see the <option>degr-wfc-timeout</option>
	      parameter.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Section <option>volume</option> Parameters</title>

      <variablelist>
        <varlistentry>
	  <term><option>device /dev/drbd<replaceable>minor-number</replaceable></option></term>
	  <term><option>device <replaceable><optional>name</optional></replaceable> <optional>minor
		<replaceable>minor-number</replaceable></optional></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>device</secondary>
	      </indexterm> Define the device name and minor number of a
	      replicated block device.  This is the device that applications
	      are supposed to access; in most cases, the device is not used
	      directly, but as a file system.</para>

	    <para>The first form of this parameter assumes the standard
	      device naming convention.  The second form supports arbitrary
	      device names: if the device name is omitted, the standard device
	      naming convention is used; if the minor number is omitted, one of
	      the available minor numbers is used.</para>

	    <para>In addition to this device, udev will create
	      /dev/drbd/by-res/<replaceable>resource</replaceable>/<replaceable>volume</replaceable>
	      and /dev/drbd/by-disk/drbd<replaceable>minor-number</replaceable>
	      symlinks to the device.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>disk <replaceable>device</replaceable></option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>disk</secondary>
	      </indexterm> Define the lower-level block device that DRBD will
	      use for storing the actual data.  While the replicated drbd
	      device is configured, the lower-level device must not be used.
	      Even read-only access with tools like <citerefentry>
		<refentrytitle>dumpe2fs</refentrytitle>
		<manvolnum>8</manvolnum> </citerefentry> and similar is not
	      allowed.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><option>meta-disk internal</option></term>

          <term><option>meta-disk <replaceable>device</replaceable></option></term>

	  <term><option>meta-disk <replaceable>device</replaceable> [<replaceable>index</replaceable>]</option></term>

          <listitem>
            <para><indexterm significance="normal">
                <primary>drbd.conf</primary>

                <secondary>meta-disk</secondary>
	      </indexterm> Define where the metadata of a replicated block
	      device resides: it can be internal, meaning that the lower-level
	      device contains both the data and the metadata, or on a separate
	      device.</para>

	    <para>When the <replaceable>index</replaceable> form of this
	      parameter is used, multiple replicated devices can share the same
	      metadata device, each using a separate index.  Each index
	      occupies 128 MiB of data, which corresponds to a replicated
	      device size of at most 4 GiB.  We recommend not to share metadata
	      devices anymore, and to instead use the lvm volume manager for
	      creating metadata devices as needed.</para>

	    <para>When the <replaceable>index</replaceable> form of this
	      parameter is not used, the size of the lower-level device
	      determines the size of the metadata.  The size needed is 36 KiB +
	      (size of lower-level device) / 32K * (number of nodes - 1).  If
	      the metadata device is bigger than that, the extra space is not
	      used.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </refsect2>
  </refsect1>

  <refsect1 id="data-integrity">
    <title>Notes on data integrity</title>

    <para>DRBD supports two different mechanisms for data integrity checking:
      first, the <option>data-integrity-alg</option> network parameter allows
      to integrity check the data sent over the network.  Second, the online
      verification mechanism (<command moreinfo="none">drbdadm verify</command>
      and the <option>verify-alg</option> parameter) allows to check for
      differences in the on-disk data.</para>

    <para>Both mechanisms can produce false positives if the data is modified
      under I/O (i.e., while it is being sent over the network or written to
      disk).  This does not necessarily indicate a problem: for example, some
      file systems and applications do modify data under I/O for certain
      operations.  Swap space can also undergo changes while under I/O.</para>

    <para>Network data integrity checking tries to identify data modification
      under I/O by verifying the checksums on the sender side after sending the
      data.  If it detects a mismatch, it logs an error.  The receiver also
      logs an error when it detects a mismatch.  Thus, an error logged only on
      the receiver side indicates an error on the network, and an error logged
      on both sides indicates data modification under I/O.</para>

    <para>The most recent example of systematic data corruption was identified
      as a bug in the TCP offloading engine and driver of a certain type of
      GBit NIC in 2007: the data corruption happened on the DMA transfer from
      core memory to the card. Because the TCP checksum were calculated on the
      card, the TCP/IP protocol checksums did not detect this problem.</para>
  </refsect1>

  <refsect1>
    <title>Version</title>

    <simpara>This document was revised for version 9.0.0 of the DRBD distribution.</simpara>
  </refsect1>

  <refsect1>
    <title>Author</title>

    <simpara>Written by Philipp Reisner <email>philipp.reisner@linbit.com</email> and Lars
    Ellenberg <email>lars.ellenberg@linbit.com</email>.</simpara>
  </refsect1>

  <refsect1>
    <title>Reporting Bugs</title>

    <simpara>Report bugs to <email>drbd-user@lists.linbit.com</email>.</simpara>
  </refsect1>

  <refsect1>
    <title>Copyright</title>

    <simpara>Copyright 2001-2012 LINBIT Information Technologies, Philipp Reisner, Lars Ellenberg.
    This is free software; see the source for copying conditions. There is NO warranty; not even
    for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</simpara>
  </refsect1>

  <refsect1>
    <title>See Also</title>

    <para><citerefentry>
        <refentrytitle>drbd</refentrytitle>

        <manvolnum>8</manvolnum>
      </citerefentry>, <citerefentry>
        <refentrytitle>drbddisk</refentrytitle>

        <manvolnum>8</manvolnum>
      </citerefentry>, <citerefentry>
        <refentrytitle>drbdsetup</refentrytitle>

        <manvolnum>8</manvolnum>
      </citerefentry>, <citerefentry>
        <refentrytitle>drbdadm</refentrytitle>

        <manvolnum>8</manvolnum>
      </citerefentry>,
      <ulink url="http://www.drbd.org/users-guide/"><citetitle>DRBD User's Guide</citetitle></ulink>,
       <ulink url="http://www.drbd.org/"><citetitle>DRBD web site</citetitle></ulink></para>

  </refsect1>
</refentry>
