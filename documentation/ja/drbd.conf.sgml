<!DOCTYPE RefEntry PUBLIC "-//Davenport//DTD DocBook V3.0//EN">
<refentry>
<docinfo><date>15 Apr 2001</date></docinfo>

<refmeta>
 <refentrytitle>drbd.conf</refentrytitle>
 <manvolnum>5</manvolnum>
</refmeta>

<refnamediv>
 <refname>drbd.conf</refname>
 <refpurpose>DRBDデバイス用の設定ファイル</refpurpose>

</refnamediv>
<refsect1>
 <title>Introduction</title>
 <para>
<option>/etc/drbd.conf</option>ファイルは、DRBDの配布物に含まれている
<option>/etc/init.d/drbd</option> と <option>/etc/ha.d/resrouce.d/datadisk</option> 
から読み込まれます。
</para>
<para>
書式については、クラスタ内の両ノード上で全く同一内容のファイルを保存して使えるように
設計されており、設定に関する運用がしやすくなっています。

<example>
<title>drbd.conf ファイル</title>
<programlisting>
resource drbd0 {
  protocol=C
  fsckcmd=fsck.ext2 -p -y

  on thost1 {
    device=/dev/nb1
    disk=/dev/hda7
    address=10.1.1.31
    port=7789
  }

  on thost2 {
    device=/dev/nb1
    disk=/dev/hda7
    address=10.1.1.32
    port=7789
  }
}	
</programlisting>
</example>
この例では、デバイス間の接続にプロトコルCを使用する1つのDRBD resource
(drbd0と呼びます)があります。
このresourceのアプリケーションはext2ファイルシステムで、それを再起動するコマンドは
<replaceable>fsck.ext2 -p -y</replaceable>です。
ホスト <replaceable>thost1</replaceable> 上で動作するデバイスは、その
アプリケーション用のデバイスとして<replaceable>/dev/nb1</replaceable>を使用し、
データ用のローレベル記憶領域として<replaceable>/dev/hda7</replaceable>を使用します。
IPアドレスはネットワークインターフェースを特定するために使用します。
</para>
<para>
1つのdrbd.confファイル内に複数のresourceセクションを書くこともあります。
</para>
</refsect1>
<refsect1>
 <title>File Format</title>
  <para>
このファイルはセクションとパラメータ行で構成されます。
セクションはキーワードで始まり、名前や空きかっこが付くこともあります。
セクションは閉じかっこで終わります。
</para>
<para>
パラメータ行は、パラメータ識別子と等号(<quote>=</quote>)で始まります。
その後に続く文字列はすべてパラメータの値として見なされます。
識別子と等号の間には、スペースが入らないようにする必要があります。
特別なケースは、識別子のみがあるかないかで意味があるブール値パラメータです。
</para>
<para>
コメント行を設定ファイルに書くことができますが、その場合、行の左端のハッシュ記号
(<quote>#</quote>) で始める必要があります。

  </para>
 <refsect2>
 <title>Sections</title>
<variablelist>
 <varlistentry>
  <term><option>resource <replaceable>name</replaceable></option></term>
  <listitem><para>
    DRBD resourceを設定します。
    すべてのresourceセクションで、2つのホストセクション(キーワード <option>on</option>)が存在する必要があります。
    <option>net</option> と <option>disk</option>セクションが存在することもあります。
    このセクションで必要なパラメータ: <option>protocol</option>、<option>fsckcmd</option>。
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>on <replaceable>host-name</replaceable></option></term>
  <listitem><para>
    この行を囲んでいるresourceのDRBDデバイス用に必要な環境設定パラメータを記述します。
    このセクションで必要なパラメータ: <option>device</option>、<option>disk</option>、<option>address</option>、<option>port</option>。
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>disk</option></term>
  <listitem><para>
    このセクションはローレベル記憶装置に応じてDRBDの属性を調整するために使用します。
    パラメータの詳細については、<citerefentry><refentrytitle>drbdsetup</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry> を参照してください。
    使用可能なパラメータ: <option>disk-size</option>、<option>do-panic</option>。
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>net</option></term>
  <listitem><para>
    このセクションはDRBDの属性を調整するために使用します。
    パラメータの詳細については、<citerefentry><refentrytitle>drbdsetup</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry>を参照してください。
    使用可能なパラメータ: <option>sync-rate</option>、 
    <option>connect-int</option>、 <option>skip-sync</option>、
    <option>ping-int</option>、 <option>timeout</option>、
    <option>tl-size</option>。
  </para>
  </listitem>
</varlistentry>
</variablelist>
 </refsect2>
 <refsect2>
 <title>Parameter</title>

<variablelist>
 <varlistentry>
  <term><option>protocol=<replaceable>prot-id</replaceable></option></term>
  <listitem><para>
    <replaceable>prot-id</replaceable> は A か B か C です。 
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>fsckcmd=<replaceable>command</replaceable></option></term>
  <listitem><para>
    resource がテイクオーバーした時に、datadisk が resource のデバイス上で
    <replaceable>command</replaceable>を実行します。
    ファイルシステムを一貫性のある状態にさせるためのコマンドをここに記述してください。
    ジャーナリングファイルシステムの場合は、代わりに<replaceable>/bin/true</replaceable>を
    記述しておくこともできます。
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>inittimeout=<replaceable>value</replaceable></option></term>
  <listitem><para>

    相手ノードを特定の期間内に検出できない場合、このノードがresourceを起動します。 
   </para>
    <para>
    このオプションは、データの信頼性よりも可用性のほうがより重要な場合にのみ使用してください。
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>port=<replaceable>number</replaceable></option></term>
  <listitem><para>
    各 DRBD resource には相手ノードのデバイスと接続するために使う
    TCPポート番号<replaceable>number</replaceable>が必要です。     
    2つの DRBD resource で同じポート番号を使うことはできません。
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>device=<replaceable>name</replaceable></option></term>
  <listitem><para>
    resourceで記述されているノードのブロックデバイスの名前です。
    アプリケーション(ファイルシステム)からは、このデバイスを使用する必要があります。
    <option>disk=</option>パラメータのほうで指定したブロックデバイスを使用してはなりません。
  </para>
  <para>
    デバイスのノードはDRBDドライバと同じメジャー番号を持つ必要があります。 
    現時点での実装ではメジャー番号43が使用され、該当するデバイスノードは
    たいてい<option>/dev/nb0</option>、<option>/dev/nb1</option>のように
    名づけられます。
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>disk=<replaceable>name</replaceable></option></term>
  <listitem><para>
    DRBDはこのブロックデバイスを実際にデータを読み書きするために使います。
    DRBDがそのブロックデバイス上で動作している限りは、これらのデバイスに
    絶対にアクセスしないで下さい。
    このことは、<citerefentry><refentrytitle>dumpe2fs</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry>やその他同様の動作をするコマンドに
    ついても同じです。
  </para>
  </listitem>
</varlistentry>
 <varlistentry>
  <term><option>address=<replaceable>ip-addr</replaceable></option></term>
  <listitem><para>
    1つの resource 内では、相手のデバイスと通信するために、デバイスごとに1つのIPアドレスを必要とします。
  </para>
  </listitem>
</varlistentry>

</variablelist>
</refsect2>
</refsect1>
<refsect1>
<title>Author</title>
<simpara>
    著者：Philipp Reisner <email>philipp.reisner@linbit.com</email>
</simpara>
</refsect1>
<refsect1>
<title>Reporting Bugs</title>
<simpara>
    バグが見つかったら<email>drbd-devel@lists.sourceforge.net</email>まで報告してください。
</simpara>
</refsect1>
<refsect1>
<title>Copyright</title>
<simpara>
Copyright (c) 2001 Philipp Reisner. This  is  free software; 
see the source for copying conditions.  There is NO warranty; 
not even for MERCHANTABILIT  or FITNESS FOR A PARTICULAR PURPOSE.
</simpara>
  <simpara>
    訳：久世 宏明 Copyright (c) 2002
  </simpara>
</refsect1>
<refsect1>
<title>See Also</title>
<para>
    <citerefentry><refentrytitle>drbd</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry>,
    <citerefentry><refentrytitle>datadisk</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry>,
    <citerefentry><refentrytitle>drbdsetup</refentrytitle>
    <manvolnum>8</manvolnum></citerefentry>
</para>
</refsect1>
</refentry>






