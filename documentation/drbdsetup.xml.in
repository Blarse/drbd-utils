<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
  <!ENTITY drbdsetup_options SYSTEM "./drbdsetup-options.xml">
]>
<refentry id="re-drbdsetup">
  &drbdsetup_options;

  <refentryinfo>
    <date>6 May 2011</date>

    <productname>DRBD</productname>

    <productnumber>8.4.0</productnumber>
  </refentryinfo>

  <refmeta>
    <refentrytitle>drbdsetup</refentrytitle>

    <manvolnum>8</manvolnum>

    <refmiscinfo class="manual">System Administration</refmiscinfo>
  </refmeta>

  <refnamediv>
    <refname>drbdsetup</refname>

    <refpurpose>Setup tool for DRBD <indexterm significance="normal">
        <primary>drbdsetup</primary>
      </indexterm></refpurpose>
  </refnamediv>

  <refsynopsisdiv>
    <xi:include href="drbdsetup_attach.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_check-resize.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_connect.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_cstate.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_del-minor.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_del-resource.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_detach.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_disconnect.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_disk-options.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_down.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_dstate.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_events.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_get-gi.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_invalidate.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_invalidate-remote.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_net-options.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_new-current-uuid.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_new-minor.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_new-resource.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_outdate.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_pause-sync.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_primary.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_resize.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_resource-options.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_resume-io.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_resume-sync.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_role.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_secondary.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_show.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_show-gi.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_suspend-io.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_verify.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_wait-connect.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    <xi:include href="drbdsetup_wait-sync.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
  </refsynopsisdiv>

  <refsect1>
    <title>Description</title>

    <para>drbdsetup is used to associate DRBD devices with their backing block devices, to set up
    DRBD device pairs to mirror their backing block devices, and to inspect the configuration of
    running DRBD devices.</para>
  </refsect1>

  <refsect1>
    <title>Note</title>

    <para>drbdsetup is a low level tool of the DRBD program suite. It is used by the data disk and
    drbd scripts to communicate with the device driver.</para>
  </refsect1>

  <refsect1>
    <title>Commands</title>

    <para>Each drbdsetup sub-command might require arguments and bring its own set of options. All
    values have default units which might be overruled by K, M or G. These units are defined in
    the usual way (e.g. K = 2^10 = 1024).</para>

    <refsect2>
      <title>Common options</title>

      <para>All drbdsetup sub-commands accept these two options <variablelist>
          <varlistentry>
            <term><option>--create-device</option></term>

            <listitem>
              <para>In case the specified DRBD device (minor number) does not exist yet, create it
              implicitly.</para>
            </listitem>
          </varlistentry>
        </variablelist></para>
    </refsect2>

    <refsect2>
      <title>attach, disk-options</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>disk</secondary>
      </indexterm>

      <para>Attach associates <replaceable>device</replaceable> with
      <replaceable>lower_device</replaceable> to store its data blocks on. The <option>-d</option>
      (or <option>--disk-size</option>) should only be used if you wish not to use as much as
      possible from the backing block devices. If you do not use <option>-d</option>, the
      <replaceable>device</replaceable> is only ready for use as soon as it was connected to its
      peer once. (See the <option>net</option> command.)</para>

      <para>With the disk-options command it is possible to change the options of a minor while it
      is attached.</para>

      <variablelist>
	<pick_drbdsetup_option name="al-extents"/>
	<pick_drbdsetup_option name="al-updates"/>
	<pick_drbdsetup_option name="c-delay-target"/>
	<pick_drbdsetup_option name="c-min-rate"/>
	<pick_drbdsetup_option name="disk-barrier"/>
	<pick_drbdsetup_option name="disk-size"/>
	<pick_drbdsetup_option name="disk-timeout"/>
	<pick_drbdsetup_option name="fencing"/>
	<pick_drbdsetup_option name="md-flushes"/>
	<pick_drbdsetup_option name="on-io-error"/>
	<pick_drbdsetup_option name="read-balancing"/>
	<pick_drbdsetup_option name="resync-after"/>
	<pick_drbdsetup_option name="resync-rate"/>

      </variablelist>
    </refsect2>

    <refsect2>
      <title>check-resize</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>check-resize</secondary>
      </indexterm>

      <para>To enable DRBD to detect offline resizing of backing devices this command may be used
      to record the current size of backing devices. The size is stored in files in /var/lib/drbd/
      named drbd-minor-??.lkbd</para>

      <para>This command is called by <command moreinfo="none">drbdadm resize
      <replaceable>res</replaceable></command> after <command moreinfo="none">drbdsetup
      <replaceable>device</replaceable> resize</command> returned.</para>
    </refsect2>

    <refsect2>
      <title>connect, net-options</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>net</secondary>
      </indexterm>

      <para>Connect sets up the <replaceable>device</replaceable> to listen on
      <replaceable>af:local_addr:port</replaceable> for incoming connections and to try to connect
      to <replaceable>af:remote_addr:port</replaceable>. If <replaceable>port</replaceable> is
      omitted, 7788 is used as default. If <replaceable>af</replaceable> is omitted
      <option>ipv4</option> gets used. Other supported address families are <option>ipv6</option>,
      <option>ssocks</option> for Dolphin Interconnect Solutions' "super sockets" and
      <option>sdp</option> for Sockets Direct Protocol (Infiniband).</para>

      <para>The net-options command allows you to change options while the connection is
      established.</para>

      <variablelist>

	<pick_drbdsetup_option name="after-sb-0pri"/>
	<pick_drbdsetup_option name="after-sb-1pri"/>
	<pick_drbdsetup_option name="after-sb-2pri"/>
	<pick_drbdsetup_option name="allow-two-primaries"/>
	<pick_drbdsetup_option name="always-asbp"/>
	<pick_drbdsetup_option name="connect-int"/>
	<pick_drbdsetup_option name="cram-hmac-alg"/>
	<pick_drbdsetup_option name="csums-alg"/>
	<pick_drbdsetup_option name="data-integrity-alg"/>
	<pick_drbdsetup_option name="ko-count"/>
	<pick_drbdsetup_option name="max-buffers"/>
	<pick_drbdsetup_option name="max-epoch-size"/>
	<pick_drbdsetup_option name="on-congestion"/>
	<pick_drbdsetup_option name="ping-int"/>
	<pick_drbdsetup_option name="ping-timeout"/>
	<pick_drbdsetup_option name="protocol"/>
	<pick_drbdsetup_option name="rcvbuf-size"/>
	<pick_drbdsetup_option name="rr-conflict"/>
	<pick_drbdsetup_option name="shared-secret"/>
	<pick_drbdsetup_option name="sndbuf-size"/>
	<pick_drbdsetup_option name="tcp-cork"/>
	<pick_drbdsetup_option name="timeout"/>
	<pick_drbdsetup_option name="unplug-watermark"/>
	<pick_drbdsetup_option name="use-rle"/>
	<pick_drbdsetup_option name="verify-alg"/>
	<pick_drbdsetup_option name="discard-my-data"/>
	<pick_drbdsetup_option name="tentative"/>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>cstate</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>cstate</secondary>
      </indexterm>

      <para>Shows the current connection state of the <replaceable>device</replaceable>.</para>
    </refsect2>

    <refsect2>
      <title>del-minor</title>

      <para>Minors can only be destroyed if its disk is detached.</para>
    </refsect2>

    <refsect2>
      <title>del-resource</title>

      <para>Destroys a resource object. This is only possible if the resource has no
      volumes.</para>
    </refsect2>

    <refsect2>
      <title>detach</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>detach</secondary>
      </indexterm>
      <para>Removes the information set by the <option>disk</option> command from the
      <replaceable>device</replaceable>. This means that the <replaceable>device</replaceable> is
      detached from its backing storage device.
      <variablelist>
        <varlistentry>
          <term><option>-f</option>,
	  <option>--force</option></term>
          <listitem>
            <para>A regular detach returns after the disk state finally reached
	    diskless. As a consequence detaching from a frozen backing block device
	    never terminates.</para>
	    <para>On the other hand A forced detach returns immediately. It allows
	    you to detach DRBD from a frozen backing block device. Please note that
	    the disk will be marked as failed until all pending IO requests where
	    finished by the backing block device.
	    </para>
          </listitem>
        </varlistentry>
      </variablelist>
      </para>
    </refsect2>

    <refsect2>
      <title>disconnect</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>disconnect</secondary>
      </indexterm>

      <para>Removes the information set by the <option>net</option> command from the
      <replaceable>device</replaceable>. This means that the <replaceable>device</replaceable>
      goes into unconnected state and will no longer listen for incoming connections.</para>
    </refsect2>

    <refsect2>
      <title>down</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>down</secondary>
      </indexterm>

      <para>Removes all configuration information from the <replaceable>device</replaceable> and
      forces it back to unconfigured state.</para>
    </refsect2>

    <refsect2>
      <title>dstate</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>dstate</secondary>
      </indexterm>

      <para>Shows the current states of the backing storage devices, as
      <replaceable>local</replaceable>/<replaceable>peer</replaceable>.</para>
    </refsect2>

    <refsect2>
      <title>events</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>events</secondary>
      </indexterm>

      <para>Displays every state change of DRBD and all calls to helper programs. This might be
      used to get notified of DRBD's state changes by piping the output to another program.
      <variablelist>
          <varlistentry>
            <term><option>--all-devices</option></term>

            <listitem>
              <para>Display the events of all DRBD minors.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><option>--unfiltered</option></term>

            <listitem>
              <para>This is a debugging aid that displays the content of all received netlink
              messages.</para>
            </listitem>
          </varlistentry>
        </variablelist></para>
    </refsect2>

    <refsect2>
      <title>get-gi</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>get-gi</secondary>
      </indexterm>

      <para>Displays the device's data generation identifiers.</para>
    </refsect2>

    <refsect2>
      <title>invalidate</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>invalidate</secondary>
      </indexterm>

      <para>This forces the local device of a pair of connected DRBD devices into SyncTarget
      state, which means that all data blocks of the device are copied over from the peer.</para>

      <para>This command will fail if the <replaceable>device</replaceable> is not part of a
      connected device pair.</para>
    </refsect2>

    <refsect2>
      <title>invalidate-remote</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>invalidate-remote</secondary>
      </indexterm>

      <para>This forces the local device of a pair of connected DRBD devices into SyncSource
      state, which means that all data blocks of the device are copied to the peer.</para>

      <para>On a disconnected device, this will set all bits in the out of sync bitmap. As a side
      effect, this suspends updates to the on disk activity log. Updates to the on disk activity log
      will be resumed automatically when necessary.</para>
    </refsect2>

    <refsect2>
      <title>new-current-uuid</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>new-current-uuid</secondary>
      </indexterm>

      <para>Generates a new current UUID and rotates all other UUID values. This has at least two
      use cases, namely to skip the initial sync, and to reduce network bandwidth when starting in
      a single node configuration and then later (re-)integrating a remote site.</para>

      <para>Available option: <variablelist>
          <varlistentry>
            <term><option>--clear-bitmap</option></term>

            <listitem>
              <para>Clears the sync bitmap in addition to generating a new current UUID.</para>
            </listitem>
          </varlistentry>
        </variablelist></para>

      <para>This can be used to skip the initial sync, if you want to start from scratch. This
      use-case does only work on "Just Created" meta data. Necessary steps: <orderedlist
          continuation="restarts" inheritnum="ignore" numeration="arabic">
          <listitem>
            <simpara>On <emphasis>both</emphasis> nodes, initialize meta data and configure the
            device.</simpara>

            <simpara><command moreinfo="none">drbdadm create-md --force
            <replaceable>res</replaceable></command></simpara>
          </listitem>

          <listitem>
            <simpara>They need to do the initial handshake, so they know their sizes.</simpara>

            <simpara><command moreinfo="none">drbdadm up
            <replaceable>res</replaceable></command></simpara>
          </listitem>

          <listitem>
            <simpara>They are now Connected Secondary/Secondary Inconsistent/Inconsistent.
            Generate a new current-uuid and clear the dirty bitmap.</simpara>

            <simpara><command moreinfo="none">drbdadm new-current-uuid --clear-bitmap
            <replaceable>res</replaceable></command></simpara>
          </listitem>

          <listitem>
            <simpara>They are now Connected Secondary/Secondary UpToDate/UpToDate. Make one side
            primary and create a file system.</simpara>

            <simpara><command moreinfo="none">drbdadm primary
            <replaceable>res</replaceable></command></simpara>

            <simpara><command moreinfo="none">mkfs -t <replaceable>fs-type</replaceable> $(drbdadm
            sh-dev <replaceable>res</replaceable>)</command></simpara>
          </listitem>
        </orderedlist></para>

      <para>One obvious side-effect is that the replica is full of old garbage (unless you made
      them identical using other means), so any online-verify is expected to find any number of
      out-of-sync blocks.</para>

      <para><emphasis>You must not use this on pre-existing data!</emphasis> Even though it may
      appear to work at first glance, once you switch to the other node, your data is toast, as it
      never got replicated. So <emphasis>do not leave out the mkfs</emphasis> (or
      equivalent).</para>

      <para>This can also be used to shorten the initial resync of a cluster where the second node
      is added after the first node is gone into production, by means of disk shipping. This
      use-case works on disconnected devices only, the device may be in primary or secondary
      role.</para>

      <para>The necessary steps on the current active server are: <orderedlist
          continuation="restarts" inheritnum="ignore" numeration="arabic">
          <listitem>
            <simpara><command moreinfo="none">drbdsetup new-current-uuid --clear-bitmap <replaceable>minor</replaceable>
            </command></simpara>
          </listitem>

          <listitem>
            <simpara>Take the copy of the current active server. E.g. by pulling a disk out of the
            RAID1 controller, or by copying with dd. You need to copy the actual data, and the
            meta data.</simpara>
          </listitem>

          <listitem>
            <simpara><command moreinfo="none">drbdsetup new-current-uuid <replaceable>minor</replaceable>
            </command></simpara>
          </listitem>
        </orderedlist> Now add the disk to the new secondary node, and join it to the cluster. You
      will get a resync of that parts that were changed since the first call to <command
      moreinfo="none">drbdsetup</command> in step 1.</para>
    </refsect2>
    <refsect2>
      <title>new-minor</title>

      <para>A <emphasis>minor</emphasis> is used as a synonym for replicated block device. It is
      represented in the /dev/ directory by a block device. It is the application's interface to
      the DRBD-replicated block devices. These block devices get addressed by their minor numbers
      on the drbdsetup commandline.</para>

      <para>A pair of replicated block devices may have different minor numbers on the two
      machines. They are associated by a common <emphasis>volume-number</emphasis>. Volume numbers
      are local to each connection. Minor numbers are global on one node.</para>
    </refsect2>

    <refsect2>
      <title>new-resource</title>

      <para>Resources are the primary objects of any DRBD configuration. A resource must be created
      with the <option>new-resource</option> command before any volumes or minor devices can be created.
      Connections are referenced by name.</para>
    </refsect2>

    <refsect2>
      <title>outdate</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>outdate</secondary>
      </indexterm>

      <para>Mark the data on the local backing storage as outdated. An outdated device refuses to
      become primary. This is used in conjunction with <option>fencing</option> and by the peer's
      <option>fence-peer</option> handler.</para>
    </refsect2>

    <refsect2>
      <title>pause-sync</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>pause-sync</secondary>
      </indexterm>

      <para>Temporarily suspend an ongoing resynchronization by setting the local pause flag.
      Resync only progresses if neither the local nor the remote pause flag is set. It might be
      desirable to postpone DRBD's resynchronization after eventual resynchronization of the
      backing storage's RAID setup.</para>
    </refsect2>

    <refsect2>
      <title>primary</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>primary</secondary>
      </indexterm>

      <para>Sets the <replaceable>device</replaceable> into primary role. This means that
      applications (e.g. a file system) may open the <replaceable>device</replaceable> for read
      and write access. Data written to the <replaceable>device</replaceable> in primary role are
      mirrored to the device in secondary role.</para>

      <para>Normally it is not possible to set both devices of a connected DRBD device pair to
      primary role. By using the <option>--allow-two-primaries</option> option, you override this
      behavior and instruct DRBD to allow two primaries.</para>

      <variablelist>
        <varlistentry>
          <term><option>--overwrite-data-of-peer</option></term>

          <listitem>
            <para>Alias for --force.</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <variablelist>
        <varlistentry>
          <term><option>--force</option></term>

          <listitem>
            <para>Becoming primary fails if the local replica is not up-to-date. I.e. when it is
            inconsistent, outdated of consistent. By using this option you can force it into
            primary role anyway. USE THIS OPTION ONLY IF YOU KNOW WHAT YOU ARE DOING.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>resize</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>resize</secondary>
      </indexterm>

      <para>This causes DRBD to reexamine the size of the <replaceable>device</replaceable>'s
      backing storage device. To actually do online growing you need to extend the backing
      storages on both devices and call the <option>resize</option> command on one of your
      nodes.</para>

      <para>The <option>--assume-peer-has-space</option> allows you to resize a device which is
      currently not connected to the peer. Use with care, since if you do not resize the peer's
      disk as well, further connect attempts of the two will fail.</para>

      <para>When the <option>--assume-clean</option> option is given DRBD will skip the resync of
      the new storage. Only do this if you know that the new storage was initialized to the same
      content by other means.</para>
    </refsect2>

    <refsect2>
      <title>resource-options</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>resource-options</secondary>
      </indexterm>

      <para>Changes the options of the resource at runtime.</para>

      <variablelist>
	<pick_drbdsetup_option name="auto-promote"/>
	<pick_drbdsetup_option name="cpu-mask"/>
	<pick_drbdsetup_option name="on-no-data-accessible"/>
	<pick_drbdsetup_option name="peer-ack-window"/>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>resume-io</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>resume-io</secondary>
      </indexterm>

      <para>If the fence-peer handler fails to stonith the peer node, and your
      <option>fencing</option> policy is set to resource-and-stonith, you can unfreeze IO
      operations with this command.</para>
    </refsect2>

    <refsect2>
      <title>resume-sync</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>resume-sync</secondary>
      </indexterm>

      <para>Unset the local sync pause flag.</para>
    </refsect2>

    <refsect2>
      <title>role</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>role</secondary>
      </indexterm>

      <para>Shows the current roles of the <replaceable>device</replaceable> and its peer, as
      <replaceable>local</replaceable>/<replaceable>peer</replaceable>.</para>
    </refsect2>

    <refsect2>
      <title>secondary</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>secondary</secondary>
      </indexterm>

      <para>Brings the <replaceable>device</replaceable> into secondary role. This operation fails
      as long as at least one application (or file system) has opened the device.</para>

      <para>It is possible that both devices of a connected DRBD device pair are secondary.</para>
    </refsect2>

    <refsect2>
      <title>show</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>show</secondary>
      </indexterm>

      <para>Shows all available configuration information of the
      <replaceable>device</replaceable>.</para>
    </refsect2>

    <refsect2>
      <title>show-gi</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>show-gi</secondary>
      </indexterm>

      <para>Displays the device's data generation identifiers verbosely.</para>
    </refsect2>

    <refsect2>
      <title>state</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>state</secondary>
      </indexterm>

      <para>Deprecated alias for "role"</para>
    </refsect2>

    <refsect2>
      <title>suspend-io</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>suspend-io</secondary>
      </indexterm>

      <para>This command is of no apparent use and just provided for the sake of
      completeness.</para>
    </refsect2>

    <refsect2>
      <title>verify</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>verify</secondary>
      </indexterm>

      <para>This initiates on-line device verification. During on-line verification, the contents
      of every block on the local node are compared to those on the peer node. Device verification
      progress can be monitored via <filename moreinfo="none">/proc/drbd</filename>. Any blocks
      whose content differs from that of the corresponding block on the peer node will be marked
      out-of-sync in DRBD's on-disk bitmap; they are <emphasis>not</emphasis> brought back in sync
      automatically. To do that, simply disconnect and reconnect the resource.</para>

      <para>If on-line verification is already in progress (and this node is "VerifyS"),
	this command silently "succeeds". In this case, any start-sector (see
	below) will be ignored, and any stop-sector (see below) will be honored.
	This can be used to stop a running verify, or to update/shorten/extend
	the coverage of the currently running verify.
      </para>

      <para>This command will fail if the <replaceable>device</replaceable> is not part of a
      connected device pair.</para>

      <para>See also the notes on data integrity on the drbd.conf manpage.</para>

      <variablelist>
        <varlistentry>
          <term><option>--start
          <replaceable>start-sector</replaceable></option></term>

          <listitem>
            <para>Since version 8.3.2, on-line verification should resume from the last position
            after connection loss. It may also be started from an arbitrary position by setting
	    this option. If you had reached some stop-sector before, and you do
	    not specify an explicit start-sector, verify should resume from the
	    previous stop-sector.</para>

            <para>Default unit is sectors. You may also specify a unit explicitly. The
            <option>start-sector</option> will be rounded down to a multiple of 8 sectors
            (4kB).</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term><option>-S</option>,
	  <option>--stop <replaceable>stop-sector</replaceable></option></term>
          <listitem>
            <para>Since version 8.3.14, on-line verification can be stopped
	      before it reaches end-of-device.
            </para>
            <para>Default unit is sectors. You may also specify a unit explicitly.
              The <option>stop-sector</option> may be updated by issuing an additional
	      drbdsetup verify command on the same node while the verify is running.
	      This can be used to stop a running verify, or to update/shorten/extend
	      the coverage of the currently running verify.
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>wait-connect</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>wait-connect</secondary>
      </indexterm>

      <para>Returns as soon as the <replaceable>device</replaceable> can communicate with its
      partner device.</para>

      <variablelist>
        <varlistentry>
          <term><option>--wfc-timeout
          <replaceable>wfc_timeout</replaceable></option></term>

          <term><option>--degr-wfc-timeout
          <replaceable>degr_wfc_timeout</replaceable></option></term>

          <term><option>--outdated-wfc-timeout
          <replaceable>outdated_wfc_timeout</replaceable></option></term>

          <term><option>--wait-after-sb</option></term>

          <listitem>
            <para>This command will fail if the <replaceable>device</replaceable> cannot
            communicate with its partner for <replaceable>timeout</replaceable> seconds. If the
            peer was working before this node was rebooted, the
            <replaceable>wfc_timeout</replaceable> is used. If the peer was already down before
            this node was rebooted, the <replaceable>degr_wfc_timeout</replaceable> is used. If
            the peer was successfully outdated before this node was rebooted the
            <replaceable>outdated_wfc_timeout</replaceable> is used. The default value for all
            those timeout values is 0 which means to wait forever. The unit is seconds. In case
            the connection status goes down to StandAlone because the peer appeared but the
            devices had a split brain situation, the default for the command is to terminate. You
            can change this behavior with the <option>--wait-after-sb</option> option.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>wait-sync</title>

      <indexterm significance="normal">
        <primary>drbdsetup</primary>

        <secondary>wait-sync</secondary>
      </indexterm>

      <para>Returns as soon as the <replaceable>device</replaceable> leaves any synchronization
      into connected state. The options are the same as with the
      <replaceable>wait-connect</replaceable> command.</para>
    </refsect2>
  </refsect1>

  <refsect1>
    <title>Examples</title>

    <para>For examples, please have a look at the
    <ulink url="http://www.drbd.org/users-guide/"><citetitle>DRBD User's Guide</citetitle></ulink>.</para>

  </refsect1>

  <refsect1>
    <title>Version</title>

    <simpara>This document was revised for version 8.3.2 of the DRBD distribution.</simpara>
  </refsect1>

  <refsect1>
    <title>Author</title>

    <simpara>Written by Philipp Reisner <email>philipp.reisner@linbit.com</email> and Lars
    Ellenberg <email>lars.ellenberg@linbit.com</email></simpara>
  </refsect1>

  <refsect1>
    <title>Reporting Bugs</title>

    <simpara>Report bugs to <email>drbd-user@lists.linbit.com</email>.</simpara>
  </refsect1>

  <refsect1>
    <title>Copyright</title>

    <simpara>Copyright 2001-2008 LINBIT Information Technologies, Philipp Reisner, Lars Ellenberg.
    This is free software; see the source for copying conditions. There is NO warranty; not even
    for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</simpara>
  </refsect1>

  <refsect1>
    <title>See Also</title>

    <para><citerefentry>
        <refentrytitle>drbd.conf</refentrytitle>

        <manvolnum>5</manvolnum>
      </citerefentry>, <citerefentry>
        <refentrytitle>drbd</refentrytitle>

        <manvolnum>8</manvolnum>
      </citerefentry>, <citerefentry>
        <refentrytitle>drbddisk</refentrytitle>

        <manvolnum>8</manvolnum>
      </citerefentry>, <citerefentry>
        <refentrytitle>drbdadm</refentrytitle>

        <manvolnum>8</manvolnum>
      </citerefentry>,
      <ulink url="http://www.drbd.org/users-guide/"><citetitle>DRBD User's Guide</citetitle></ulink>,
       <ulink url="http://www.drbd.org/"><citetitle>DRBD web site</citetitle></ulink></para>

  </refsect1>
</refentry>
